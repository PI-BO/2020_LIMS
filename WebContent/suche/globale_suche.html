<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<style>
select {
	width: 100%;
}

.table_globale_suche {
	display: flex;
	flex-flow: column;
}

.table_globale_suche_th {
	font-weight: 700;
	background-color: #f2f2f2;
	border-top: 1px solid #d0d0d0;
}

.table_globale_suche_tr {
	display: flex;
}

.table_globale_suche_tr:nth-of-type(even) {
	background-color: #ffffff;
}

.table_globale_suche_tr:nth-of-type(odd) {
	background-color: #f2f2f2;
}

.table_globale_suche_td {
	flex-grow: 2;
	flex-basis: 0;
	padding: 0.5em;
	overflow: hidden; /*Text-Overflow*/
	text-overflow: ellipsis; /* "..." nach Text-Overflow*/
	white-space: nowrap;
	border-bottom: 1px solid #d0d0d0;
}
</style>
</head>
<body>

	<div id="such_parameter_container">
		<table id="such_parameter_table">
			<tr>
				<th>
					<select id="select_main_category" onChange="GlobaleSuche.createParameters(this);">
						<option value="Projektpartner">Projektpartner</option>
						<option value="Projekt">Projekt</option>
						<option value="Probe">Probe</option>
						<option value="Experiment">Experiment</option>
						<option value="Methode">Methode</option>
					</select>
				</th>
				<th></th>
				<th style="font-weight: normal">Filter hinzufuegen</th>
				<th>
					<input type="button" value="+" onclick="GlobaleSuche.addSuchParameter()" id="globale_suche_add_parameter_button">
				</th>
				<th>
					<input type="button" value="suchen" onclick="GlobaleSuche.search()" id="globale_suche_add_parameter_button">
				</th>
			</tr>
		</table>
	</div>

	<div id="table_globale_suche">
	</div>

<!--

	<div class="table_globale_suche">
		<div class="table_globale_suche_tr table_globale_suche_th">
			<div class="table_globale_suche_td">Name</div>
			<div class="table_globale_suche_td">Items Bought</div>
			<div class="table_globale_suche_td">Clicked</div>
			<div class="table_globale_suche_td">Duration</div>
			<div class="table_globale_suche_td">Lifetime Total</div>
			<div class="table_globale_suche_td">Total</div>
		</div>

		<div class="table_globale_suche_tr">
			<div class="table_globale_suche_td">
				<span><a href="javascript:void(0)">Andrew Jackman</a></span>
			</div>
			<div class="table_globale_suche_td">
				<span>41</span>
			</div>
			<div class="table_globale_suche_td">
				<span>30</span>
			</div>
			<div class="table_globale_suche_td">
				<span>27</span>
			</div>
			<div class="table_globale_suche_td">
				<span>$176.15</span>
			</div>
			<div class="table_globale_suche_td">
				<span>$14.94</span>
			</div>
		</div>
		<div class="table_globale_suche_tr">
			<div class="table_globale_suche_td">
				<span><a href="javascript:void(0)">Oliver Ogden</a></span>
			</div>
			<div class="table_globale_suche_td">
				<span>9</span>
			</div>
			<div class="table_globale_suche_td">
				<span>3</span>
			</div>
			<div class="table_globale_suche_td">
				<span>1</span>
			</div>
			<div class="table_globale_suche_td">
				<span>$29,403.09</span>
			</div>
			<div class="table_globale_suche_td">
				<span>$1,385.58</span>
			</div>
		</div>
		<div class="table_globale_suche_tr">
			<div class="table_globale_suche_td">
				<span><a href="javascript:void(0)">Basil Ullon</a></span>
			</div>
			<div class="table_globale_suche_td">
				<span>750</span>
			</div>
			<div class="table_globale_suche_td">
				<span>535</span>
			</div>
			<div class="table_globale_suche_td">
				<span>707</span>
			</div>
			<div class="table_globale_suche_td">
				<span>$795,170.40</span>
			</div>
			<div class="table_globale_suche_td">
				<span>$341,946.34</span>
			</div>
		</div>
	</div>

-->






	<!-- HIDDEN TEMPLATE  -->

	<div id="such_parameter_row_template" style="display: none;">
		<select class="such_parameter">
			<option value="Name">Name</option>
			<option>ID</option>
		</select> <select>
			<option>entspricht</option>
			<option>beinhaltet</option>
		</select>
		<input class="such_parameter_inhalt" type="text" />
		<input type="button" value="-" onclick="GlobaleSuche.deleteSuchParameter(this)" id="globale_suche_add_parameter_button" />
	</div>

	<!-- END TEMPLATE -->

</body>
<script>

	window.onload = function(){
		init();
	}

	function init(){
		
		document.getElementById("globale_suche_add_parameter_button").click();
	}

	class GlobaleSuche{
		
		static search(){
			
			const partner1 = {
					"pk" : "1",
					"name" : "Partner A",
			}
			
			const projekt1 = {
					"pk" : "1",
					"name" : "Projekt 1",
					"fk" : "1"
			}
			
			const probe1 = {
					"pk" : "1",
					"name" : "Probe 1",
					"fk" : "1"
			}
			
			const experiment1 = {
					"pk" : "1",
					"name" : "Experiment 1",
					"fk" : "1"
			}
			
			const experiment2 = {
					"pk" : "2",
					"name" : "Experiment 2",
					"fk" : "1"
			}
			
			const methode1 = {
					"pk" : "1",
					"name" : "Methode 1",
					"fk" : "1",
					"operator" : "Jon Doe"
			}
			
			const methode2 = {
					"pk" : "2",
					"name" : "Methode 2",
					"fk" : "1",
					"operator" : "Jane Doe"
			}
			
			const methode3 = {
					"pk" : "3",
					"name" : "Methode 3",
					"fk" : "2",
					"operator" : "Jane Doe"
			}
			
			const methode4 = {
					"pk" : "4",
					"name" : "Methode 4",
					"fk" : "2",
					"operator" : "Jane Doe"
			}
			
			let database = {
					"projektpartner" : [partner1],
					"projekt" : [projekt1],
					"probe" : [probe1],
					"experiment" : [experiment1, experiment2],
					"methode" : [methode1, methode2, methode3, methode4]
			}
			
			const searchCategory = document.getElementById("select_main_category").value.toLowerCase();
			
			const parameter = document.getElementsByClassName("such_parameter")[0].value.toLowerCase();
			const parameterInhalt = document.getElementsByClassName("such_parameter_inhalt")[0].value.toLowerCase();
			
			console.log(parameter, parameterInhalt);			
			
			const ergebnisListe = document.getElementById("table_globale_suche");
			
			
			while(ergebnisListe.hasChildNodes()){
				ergebnisListe.removeChild(ergebnisListe.lastChild);
			}
			
			let results = database[searchCategory];
			
			console.log(results);

			if(parameterInhalt != ""){
				
				results = results.filter((result) => {
					return result[parameter].toLowerCase() == parameterInhalt;
				})
			}
			
			
			console.log(results);
			
			const tableGlobaleSuche = document.getElementById("table_globale_suche");
			
			let tableHeaderRow = document.createElement("div");
			tableHeaderRow.classList.add("table_globale_suche_tr");
			tableHeaderRow.classList.add("table_globale_suche_th");
			
			for(let key in results[0]){
				
				let tableData = document.createElement("div");
				tableData.classList.add("table_globale_suche_td");
				tableData.append(key);
				tableHeaderRow.append(tableData);
			}
			
			tableGlobaleSuche.append(tableHeaderRow);
			
			results.forEach(result => {
				
				let tableRow = document.createElement("div");
				tableRow.classList.add("table_globale_suche_tr");
				
				for(let key in result){
					let tableData = document.createElement("div");
					tableData.classList.add("table_globale_suche_td");
					tableData.append(result[key]);
					tableRow.append(tableData);
				}
				
				tableGlobaleSuche.append(tableRow);

			});
			
			
			
			
			
		}


		static addSuchParameter() {
			
			let container = document.getElementById("such_parameter_table");
			
			let template = document.getElementById("such_parameter_row_template");
			
			let childNodes = template.children;
			
			const containerChildrenCount = container.children.length;
			const templateChildrenCount = childNodes.length;
			
			let row = container.insertRow(-1);
			
			for(let i = 0; i < childNodes.length; i++){
				
				let cell = row.insertCell(i);
				var child = childNodes[i].cloneNode(true);
				cell.append(child);
			}
		}
		
		static deleteSuchParameter(suchParameterElement) {
			
			let parent = suchParameterElement.parentElement.parentElement;
			parent.remove();
			let container = document.getElementById("test");
		}
		
		static resetSelects(element){
			
			let allSelects = element.querySelectorAll("select");
			allSelects.forEach(element => {
				element.options[0].selected="true";
			})
		}
		
		static createParameters(event){
			
			const parameterCategory = event.value;
			
		 	let selectElements = findSelectElements(event, "such_parameter");
		 	removeOptions(selectElements);
		 	let parameters = getParameters(parameterCategory); 
		 	insertParameters(parameters, selectElements);
		 	
		 	function insertParameters(parameters, selectElements){
		 		
		 		Array.from(selectElements).forEach(selectElement => {
		 			
		 			parameters.forEach(parameter => {
				 		let selectOption = document.createElement("option");
				 		selectOption.text = parameter;
				 		selectOption.value = parameter;
				 		selectElement.add(selectOption);
			 		});
		 		})
		 		
		 	}
		 	
		 	function findSelectElements(event, className){
		 		
		 		let table = document.getElementById("such_parameter_table");
		 		let selectElements = document.getElementsByClassName(className);
		 		return selectElements;
		 	}
		 	
			function removeOptions(selectElements){
				
				Array.from(selectElements).forEach(element => {
					let selectOptions = element.querySelectorAll("option");
					selectOptions.forEach(option => option.remove());
				})
				
			}
			
			function getParameters(parameterCategory){
				const parameters = {
					    "projektpartner" : ["pk", "name"],
					    "projekt" : ["pk", "name", "fk"],
					    "probe" : ["pk", "name", "fk"],
					    "experiment" : ["pk", "name", "fk"],
					    "methode" : ["pk", "name", "fk", "operator"]
				}
				  return parameters[parameterCategory.toLowerCase()];
				}
		}
	}

</script>
</html>